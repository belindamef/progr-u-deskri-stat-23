---
fontsize: 8pt
bibliography: ../Referenzen.bib
citation_package: natbib
output:
  beamer_presentation:
    highlight: tango
    keep_tex: true
    latex_engine: xelatex
    includes:
      in_header: ../Header.tex
---


```{r source R_common, include = F}
source("../R_common.R")
abb_dir = file.path(dirname(getwd()), "Abbildungen")
data_dir = file.path(dirname(getwd()), "Data")
pfad_zu_Datenordner = file.path(dirname(getwd()), "Data")
```



#  {.plain}
\center
```{r Abb otto, echo = FALSE, out.width = "20%"}
knitr::include_graphics(file.path(abb_dir,"otto.png"))
```

\vspace{2mm}

\Large
Programmierung und Deskriptive Statistik
\vspace{4mm}

\normalsize
BSc Psychologie WiSe 2022/23

\vspace{12mm}
\normalsize
Belinda Fleischmann

\vspace{3mm}
\scriptsize
Inhalte basieren auf [Programmierung und Deskriptive Statistik](https://www.ipsy.ovgu.de/ipsy_media/Methodenlehre+I/Wintersemester+2122/Programmierung+und+Deskriptive+Statistik/Vorlesungsfolien.pdf) von [Dirk Ostwald](https://www.ipsy.ovgu.de/Institut/Abteilungen+des+Institutes/Methodenlehre+I+_+Experimentelle+und+Neurowissenschaftliche+Psychologie/Team/Dirk+Ostwald.html), lizenziert unter [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.de)


# {.plain}
\vfill
\huge
\begin{center}
(11) Anwendungsbeispiel
\end{center}
\vfill


#
\vfill
\large
\setstretch{2}
Beispieldatensatz

Datenvorverarbeitung

Deskriptive Statistiken

Visualisierung

Parameterschätzung

Konfidenzintervalle

Hypothesentests
\vfill


#
\vfill
\large
\setstretch{2}
**Beispieldatensatz**

Datenvorverarbeitung

Deskriptive Statistiken

Visualisierung

Parameterschätzung

Konfidenzintervalle

Hypothesentests
\vfill

# Beispieldatensatz
\textcolor{darkblue}{Evidenzbasierte Evaluation von Psychotherapieformen bei Depression}

\normalsize
Welche Therapieform ist bei Depression wirksamer?

```{r, echo = FALSE, out.width = "110%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_klinische_forschung.pdf"))
```

# Beispieldatensatz
\textcolor{darkblue}{Evidenzbasierte Evaluation von Psychotherapieformen bei Depression}

\normalsize
Becks Depressions-Inventar (BDI) zur Depressionsdiagnostik

```{r, echo = FALSE, out.width = "100%"}
knitr::include_graphics(file.path(abb_dir,"pds_11_bdi.pdf"))
```


# Beispieldatensatz
\textcolor{darkblue}{Beispiel: Evaluation von Psychotherapieformen bei Depression}
\vspace{2mm}

```{r, echo = FALSE, out.width = "90%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_messplan.pdf"))
```


```{r, echo = F, eval = F}
# seed
set.seed(5)


# Simulationsparameter
n      = 50                         # Proband:innnen pro Gruppe
mu     = c(18, 12, 19, 14)          # \mu prä-klassisch, post-klassisch, prä-online, post-online
sigsqr = 3

# Datensimulation
D            = data.frame(
               c(rep("Klassisch",n), rep("Online", n)),
               c(round(rnorm(n, mu[1], sqrt(sigsqr))), round(rnorm(n, mu[3], sqrt(sigsqr)))),
               c(round(rnorm(n, mu[2], sqrt(sigsqr))), round(rnorm(n, mu[4], sqrt(sigsqr)))))
colnames(D)  = c("Bedingung", "Pre BDI", "Post BDI")

# Datenspeicherung
fname        = file.path(getwd(), "11_Daten", "psychotherapie_datensatz.csv")
write.csv(D, file = fname)
```


# Beispieldatensatz
Einlesen des Datensatzes mit `read.table()`
\vspace{1mm}

\footnotesize
```{r}
fname       = file.path(data_dir, "psychotherapie_datensatz.csv")
D           = read.table(fname, sep = ",", header = TRUE)
```

\small
Daten der ersten acht Proband:innen jeder Gruppe

\footnotesize
\setstretch{1}
```{r, echo = F}
# table visualization
knitr::kable(D[c(1:8, 51:58),],
             align      = "ccc",
             "pipe")
```

# Beispieldatensatz
Datensatzübersicht mit `View()`
\vspace{2mm}

```{r, echo = FALSE, out.width = "30%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_view.png"))
```



#
\vfill
\large
\setstretch{2}
Beispieldatensatz

**Datenvorverarbeitung**

Deskriptive Statistiken

Visualisierung

Parameterschätzung

Konfidenzintervalle

Hypothesentests
\vfill

# Datenvorverarbeitung

\textcolor{darkblue}{Datenvorverarbeitung}

\small
* Studienfokus ist die **Veränderung** der Depressionsymptomatik durch Therapieformen.

* Für jede Proband:in der ergibt sich diese Veränderung als **Differenz** von Post.BDI - Pre.BDI.

* Eine Reduktion der Depressionssymptomatik ergibt dabei eine **negative Zahl**.

* Es ist sinnvoller, Verbesserungen mit **positiven Zahlen** zu repräsentieren.

* Als Maß des Therapieeffekts bei Proband:in $i$ bietet sich also an

\begin{equation}
\Delta \mbox{BDI[i]} := - (\mbox{Post.BDI[i]} - \mbox{Pre.BDI[i]})
\end{equation}

* Wir betrachten in der Folge also das $\Delta \mbox{BDI}$ Maß mit folgender Interpretation

\center
\begin{tabular}{lll}
$\Delta \mbox{BDI} > 0$ & Verminderung der Depressionsymptomatik       & Wirksame Therapie      \\
$\Delta \mbox{BDI} = 0$ & Keine Veränderung der Depressionsymptomatik  & Wirkungslose Therapie  \\
$\Delta \mbox{BDI} < 0$ & Verstärkung der Depressionsymptomatik        & Schädigende Therapie   \\
\end{tabular}


# Beispieldatensatz
\vspace{1mm}
\textcolor{darkblue}{Datenvorverarbeitung}

\small
Hinzufügen einer $\Delta\mbox{BDI}$ Spalte zum Dataframe
\vspace{1mm}

\footnotesize
```{r}
fname       = file.path(data_dir, "psychotherapie_datensatz.csv") # Einlesen
D           = read.table(fname, sep = ",", header = TRUE)                    # Rohdaten
D$Delta.BDI = -(D$Post.BDI - D$Pre.BDI)                                      # \Delta BDI Maß
```

\small
Daten der ersten acht Proband:innen jeder Gruppe
\vspace{1mm}


\footnotesize
\setstretch{1}
```{r, echo = F}
# table visualization
knitr::kable(D[c(1:8, 51:58),],
             align      = "cccc",
             "pipe")
```

#
\vfill
\large
\setstretch{2}
Beispieldatensatz

Datenvorverarbeitung

**Deskriptive Statistiken**

Visualisierung

Parameterschätzung

Konfidenzintervalle

Hypothesentests
\vfill

\vfill
# Deskriptive Statistiken

\textcolor{darkblue}{Bedingungsabhängige Auswertung deskriptiver Statistiken}
\vspace{3mm}
\tiny
\setstretch{1}
```{r, echo = T}
# Initialisierung eines Dataframes
tp            = c("Klassisch", "Online")            # Therapiebedingungen
ntp           = length(tp)                          # Anzahl Therapiebedingungen
S             = data.frame(                         # Dataframeerzeugung
                n         = rep(NaN,ntp),           # Stichprobengrößen
                Max       = rep(NaN,ntp),           # Maxima
                Min       = rep(NaN,ntp),           # Minima
                Median    = rep(NaN,ntp),           # Mediane
                Mean      = rep(NaN,ntp),           # Mittelwerte
                Var       = rep(NaN,ntp),           # Varianzen
                Std       = rep(NaN,ntp),           # Standardabweichungen
                row.names = tp)                     # Therapiebedingungen

# Iterationen über Therapiebedingungen
for(i in 1:ntp){
  data        = D$Delta.BDI[D$Bedingung == tp[i]]   # Daten
  S$n[i]      = length(data)                        # Stichprobengröße
  S$Max[i]    = max(data)                           # Maxima
  S$Min[i]    = min(data)                           # Minima
  S$Median[i] = median(data)                        # Mediane
  S$Mean[i]   = mean(data)                          # Mittelwerte
  S$Var[i]    = var(data)                           # Varianzen
  S$Std[i]    = sd(data)                            # Standardabweichungen
}
```
# Deskriptive Statistiken

\textcolor{darkblue}{Bedingungsabhängige Auswertung deskriptiver Statistiken}
\vspace{3mm}
\footnotesize

```{r}
# Ausgabe
print.AsIs(S)
```
\small
\setstretch{1.8}

* Die Anzahl der Proband:innen in beiden Therapiegruppen ist gleich.
* Die Spannbreite der $\Delta\mbox{BDI}$ Daten ist in der klassischen Therapieform leicht erhöht.
* Median und Mittelwert nehmen für die klassische Therapieform leicht höhere Werte an.
* Ein $\Delta \mbox{BDI}$ Mittelwertsunterschied von 1 ist klinisch wohl eher vernachlässigbar.
* Median und Mittelwert sind in beiden Therapieformen ähnlich (unimodale Verteilung).
* Die Variabilitätsmaße zeigen eine etwas erhöhte Varabilität in der klassischen Therapieform.


# Deskriptive Statistiken
\textcolor{darkblue}{Bedingungsabhängige Visualisierung deskriptiver Statistiken}
\vspace{1mm}

\tiny
\setstretch{.7}
```{r, eval = F}
# Abbildungsparameter
par(                                            # für Details siehe ?par
  mfcol       = c(1,2),                         # 1 x 2 Panelstruktur
  family      = "sans",                         # Serif-freier Fonttyp
  pty         = "m",                            # Maximale Abbildungsregion
  bty         = "l",                            # L förmige Box
  las         = 1,                              # Horizontale Achsenbeschriftung
  xaxs        = "i",                            # x-Achse bei y = 0
  yaxs        = "i",                            # y-Achse bei x = 0
  font.main   = 1,                              # Non-Bold Titel
  cex         = 1,                              # Textvergrößerungsfaktor
  cex.main    = 1.5)                            # Titeltextvergrößerungsfaktor

# Linkes Panel: Balkendiagramm mit Fehlerbalken
mw          = S$Mean                            # Gruppenmittelwert
sd          = S$Std                             # Gruppenstandardabweichung
names(mw)   = tp                                # barplot braucht x-Werte als names
x = barplot(                                    # Ausgabe der x-Ordinaten (?barplot für Details)
  mw,                                           # Mittelwerte = Balkenhöhe
  col         = "gray90",                       # Balkenfarbe
  ylim        = c(0,12),                        # y-Achsenbegrenzung
  xlim        = c(0,3),                         # x-Achsenbegrenzung 
  xlab        = "Bedingung",                    # x-Achsenbeschriftung    
  main        = TeX("$\\Delta BDI$"))           # Titel

arrows(                                         # arrows() für Fehlerbalken (siehe ?arrows)
  x0          = x,                              # arrow start x-ordinate
  y0          = mw - sd,                        # arrow start y-ordinate
  x1          = x,                              # arrow end   x-ordinate
  y1          = mw + sd,                        # arrow end   y-ordinate
  code        = 3,                              # Pfeilspitzen beiderseits
  angle       = 90,                             # Pfeilspitzenwinkel -> Linie
  length      = 0.05)                           # Linielänge

# Rechtes Panel: Boxplot
boxplot(
  D$Delta.BDI ~ D$Bedingung,                    # Gruppierung der Delta.BDI Daten nach D$Bedingung
  ylim        = c(0,12),                        # y-Achsenbegrenzung
  col         = "gray90",                       # Boxfarbe
  ylab        = "",                             # y-Achsenbeschriftung
  xlab        = "Bedingung",                    # x-Achsenbeschriftung    
  main        = TeX("$\\Delta BDI$"))           # Titel
```

```{r, echo = F, eval = F}
# PDF Speicherung
dev.copy2pdf(
  file        = file.path(abb_dir, "pds_11_deskriptiv.pdf"),
  width       = 8,
  height      = 5)
```

# Deskriptive Statistiken
\textcolor{darkblue}{Bedingungsabhängige Visualisierung deskriptiver Statistiken}
\vspace{1mm}

```{r, echo = FALSE, out.width = "90%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_deskriptiv.pdf"))
```


#
\vfill
\large
\setstretch{2}
Beispieldatensatz

Deskriptive Statistiken

**Visualisierung**

Parameterschätzung

Konfidenzintervalle

Hypothesentests
\vfill


# Visualisierung
\vspace{1cm}
```{r, echo = FALSE, out.width = "35%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_1.pdf"))
```
\vfill

# Visualisierung
\setstretch{1.8}
\textcolor{darkblue}{R Funktionalitäten für Abbildungen}

Base Graphics

* Erstellung und bedarfsgerechte Anpassung von Abbildungen
* Eher low-level, fine tuning orientiert

Lattice und ggplot2 

* Erstellung und bedarfsgerechte Anpassung von Abbildungen
* Eher high level, an der eigenen Philosophie orientiert

Base Graphics, lattice und ggplot2 können ähnliche Abbildungen generieren

LaTeX Typesetting ist in allen Paketen unterentwickelt

# Visualisierung
\setstretch{1.8}
\textcolor{darkblue}{R Funktionalitäten für Abbildungen}

**Base Graphics**

* **Erstellung und bedarfsgerechte Anpassung von Abbildungen**
* **Eher low-level, fine tuning orientiert**

Lattice und ggplot2 

* Erstellung und bedarfsgerechte Anpassung von Abbildungen
* Eher high level, an der eigenen Philosophie orientiert

Base Graphics, lattice und ggplot2 können ähnliche Abbildungen generieren

LaTeX Typesetting ist in allen Paketen unterentwickelt

# Visualisierung
\vspace{2mm}
```{r, echo = FALSE, out.width = "55%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_2.pdf"))
```
\flushright
\footnotesize
@murrell_2019

# Visualisierung
\vspace{2mm}
```{r, echo = FALSE, out.width = "45%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_3.pdf"))
```
\flushright
\footnotesize
@murrell_2019

# Visualisierung
\vspace{2mm}
```{r, echo = FALSE, out.width = "55%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_4.pdf"))
```
\flushright
\footnotesize
@murrell_2019

# Visualisierung
\vspace{2mm}
```{r, echo = FALSE, out.width = "60%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_5.pdf"))
```
\flushright
\footnotesize
@murrell_2019

# Visualisierung
\vspace{2mm}
```{r, echo = FALSE, out.width = "55%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_6.pdf"))
```
\flushright
\footnotesize
@murrell_2019

# Visualisierung
\vspace{5mm}
```{r, echo = FALSE, out.width = "60%"}
knitr::include_graphics(file.path(abb_dir, "pds_11_graphics_7.pdf"))
```
\flushright
\footnotesize
@murrell_2019

# Visualisierung

\textcolor{darkblue}{Code Outline}
\footnotesize
\vspace{1mm}
\setstretch{1.2}
```{r, eval = F}
# Initialisierung einer neuen Abbildung
dev.new()                                                                         

# Abbildungsparameter
par( 
z.B. Arrangement von Panels, Begrenzungsstile, Schriftfonts, etc
)  

# Higher-level Abbildungsfunktion wie plot(), hist(), barplot(), ...
plot(
z.B. x- und y-Daten, Achsenlimits, Achsenbeschriftungen, Titel, Farben, etc.
Jeder Aufruf einer higher-level Graphikfunktion belegt ein neues Subpanel!
)

# Hinzufügen weiterer Daten mit lower-level Abbildungsfunktionen zum aktuellen Panel
z.B. points(), lines(), abline()

# Weitere Graphikannotation zu aktuellem Panel
z.B. legend(), text()

# Speichern der Abbildung (Größenverhältnisse erst hier final festgelegt)
z.B. dev.copy2pdf() 
```

# Visualisierung
\vspace{2mm}
Histogramme
\vspace{1mm}
\tiny
\setstretch{.8}

```{r, eval = F}
# Histogrammparameter
h           = 1                               # gewünschte Klassenbreite
b_0         = min(D$Delta.BDI)                # b_0
b_k         = max(D$Delta.BDI)                # b_0
k           = ceiling((b_k - b_0)/h)          # Anzahl der Klassen
b           = seq(b_0, b_k, by = h)           # Klassen [b_{j-1}, b_j[
ylimits     = c(0,.25)                        # y-Achsenlimits
xlimits     = c(-2,14)                        # x-Achsenlimits
therapie    = c("Klassisch" , "Online")       # Therapiebedingungen
labs        = c("Klassische Therapie",        # Abbildungslabel
                "Online Therapie")
# Abbildungsparameter
par(                                          # für Details siehe ?par
mfcol       = c(1,2),                         # 1 x 2 Panelstruktur
family      = "sans",                         # Serif-freier Fonttyp
pty         = "m",                            # Maximale Abbildungsregion
bty         = "l",                            # L förmige Box
las         = 1,                              # Horizontale Achsenbeschriftung
xaxs        = "i",                            # x-Achse bei y = 0
yaxs        = "i",                            # y-Achse bei x = 0
font.main   = 1,                              # Non-Bold Titel
cex         = 1,                              # Textvergrößerungsfaktor
cex.main    = 1)                              # Titeltextvergrößerungsfaktor

# Iteration über Therapiebedingungen
for(i in 1:2){
  hist(
  D$Delta.BDI[D$Bedingung == therapie[i]],    # Delta.BDI Werte von Therapiebedingung i
  breaks    = b,                              # Histogrammklassen
  freq      = F,                              # normierte relative Häufigkeit
  xlim      = xlimits,                        # x-Achsenlimits
  ylim      = ylimits,                        # y-Achsenlimits
  xlab      = TeX("$\\Delta$ BDI"),           # x-Achsenbeschriftung
  ylab      = "",                             # y-Achsenbeschriftung
  main      = labs[i])                        # Titelbeschriftung
}

# PDF Speicherung
dev.copy2pdf(
file        = file.path(abb_dir, "pds_11_histogramm.pdf"),
width       = 8,
height      = 4)
```

# Visualisierung
Histogramme
\vspace{.5cm}
```{r, echo = FALSE, out.width = "100%"}
knitr::include_graphics(file.path(abb_dir, "/pds_11_histogramm.pdf"))
```
\vfill
